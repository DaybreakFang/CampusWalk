![logo](https://user-images.githubusercontent.com/45456105/111107699-52743900-8592-11eb-8278-234757eaefa0.png)

# 校园逛逛 （微信小程序）
> 在校园里闲逛时的声音伴侣。进入校园，遇到有趣的地方就会告诉你，走到就会听到。还可以浏览附近的朋友分享的最新动态。

技术栈：原生小程序 + ThorUI + 云开发能力


## Install
```
 git clone https://github.com/DaybreakFang/CampusWalk
```

#### 项目的开发主要包括后台数据库的建立和维护以及前端页面的开发。主要内容如下：

- 1）实现系统定位功能，从而判断用户是否在校园内，以此来提供后续服务。 
- 2）实现地标语音介绍功能，让用户在校园范围内走到哪听到哪，即时了解身边最近的地标详情介绍。 
- 3）实现动态发布功能，使得用户结合所在地标发表相关图文动态。 
- 4）实现点赞收藏分享功能，让用户可以对自己感兴趣的动态进行相关操作，分享给身边的朋友。 
- 5）实现动态热门广场功能，每隔 10 分钟更新一次，让用户能看到校园内时下最 热门的动态。

== 注⚠️：因小程序审核机制，故线上版本无 动态发布 等相关功能，敬请谅解！ ==

### 在线体验
![image](https://user-images.githubusercontent.com/45456105/110346100-2e809700-806a-11eb-98cf-772d71bf1922.png)


### 校园定位
![image](https://user-images.githubusercontent.com/45456105/111113304-87858900-859c-11eb-9f4f-255ce59ce865.png)

整个过程可以分为四个部分。依次是获取用户定位授权、获取用户当前位置、判断用户是否在校园内、获取与用户最近的地标信息。下面分别进行详细介绍：

1）获取用户定位授权需要用到官方接口。使用接口需要经过用户授权同意才能调用。微信官方把这些接口按使用范围分成多个 scope ，用户选择对 scope 来进行授权，当授权给一个 scope 之后，其对应的所有接口都可以直接使用。在调用接口的时候：
• 如果用户未接受或拒绝过此权限会弹窗询问用户，点击同意后方可调用接口。
• 如果用户已授权，可以直接调用接口。
• 如果用户已拒绝授权，则不会出现弹窗，而是直接进入接口 fail 回调。

2）获取用户当前位置。在上一步获取用户的定位授权之后，进行下一页面。不过在载入页面之前需要检查用户是否开启手机GPS定位，因为下面需要获取用户位置坐标。刚好，微信也提供了相关接口 wx.getLocation() 。调用这个接口可以获取当前的地理位置、速度。当用户离开小程序后，此接口无法调用。

3）判断用户是否在校园内。由于微信官方并没有提供相关接口，所以需要自己编写相关逻辑代码。在查阅大量的资料之后，终于在根据W. Randolph Franklin 提出的PNPoly算法中解决了这个问题。核心算法如下：
![image](https://user-images.githubusercontent.com/45456105/111113523-e3501200-859c-11eb-9a80-8594f185e0e4.png)

4）获取与用户最近的地标信息。这一步是地标定位部分的最后一步。在这一步中，用云开发的聚合功能实现。聚合是非常强大的数据分析工具，主要用于对记录进行批量处理，可以对记录进行按条件分组、跨集合联表等一系列批量而又复杂操作，也可以基于字段（以及内嵌字段）进行类似于Excel整列整列跨字段的运算(如加、减、合并、比较等）、对内嵌的字段可以进行整列拆分、类型变换、组合等。聚合主要用于数据统计与数据挖掘，它只能进行数据库的read操作，不能write，不会修改数据库里的数据。在确定用户所在位置在目标校园范围内之后，再使用 Aggregate.geoNear() 方法可以将记录按照给定点从近到远输出。核心代码如下：
![image](https://user-images.githubusercontent.com/45456105/111113659-12668380-859d-11eb-91d9-c31b0653304b.png)


### 小程序 UI 界面截图
![image](https://user-images.githubusercontent.com/45456105/111113751-33c76f80-859d-11eb-8640-f637f475f14e.png)

![image](https://user-images.githubusercontent.com/45456105/110345681-d053b400-8069-11eb-94ae-623575cdac30.png) ![image](https://user-images.githubusercontent.com/45456105/110345715-d8abef00-8069-11eb-917f-09fdaf268391.png)
